<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="chengshuomin"><title>1. 源码学习入口 · 学习笔记</title><meta name="description" content="1. 入口文件package.json
根据运行命令，去找 dev 后配置，即找 scripts/config.js 文件的 web-full-dev

12345&amp;#123;  &amp;quot;scripts&amp;quot;: &amp;#123;    &amp;quot;dev&amp;quot;: &amp;quot;rollup"><meta name="keywords" content="Blog,博客,chengshuomin"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon1.svg"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 6.1.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a href="/">首页</a></li><li> <a href="/archives">归档</a></li><li> <a href="/tags">标签</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li></div><div class="avatar"><img src="/images/logo.jpg"></div></div></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/title.svg" style="width:200px;" alt="favicon"><h3 title=""><a href="/">学习笔记</a></h3><div class="description"><p>chengshuomin blog</p></div></div><ul class="social-links"></ul></div></div><div class="footer"><div class="p"><span> 全站 CC-BY-SA-3.0</span><i class="fa fa-star"></i><span> chengshuomin</span></div><div class="by_farbox"><span>Powered by</span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo</a><span> &</span><span>Anatolo</span></div><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>1. 源码学习入口</a></h3></div><div class="post-content"><p><h2 id><a href="#" class="headerlink" title></a><img src="/101-%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E5%85%A5%E5%8F%A3/1658329999134-ff717063-49d2-447d-8227-3c345506f6e4.png" alt="img"></h2><h2 id="1-入口文件package-json"><a href="#1-入口文件package-json" class="headerlink" title="1. 入口文件package.json"></a>1. 入口文件<code>package.json</code></h2><ul>
<li>根据运行命令，去找 <code>dev</code> 后配置，即找 <code>scripts/config.js</code> 文件的 <code>web-full-dev</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;dev&quot;: &quot;rollup -w -c scripts/config.js --environment TARGET:web-full-dev&quot;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-scripts-config-js"><a href="#2-scripts-config-js" class="headerlink" title="2. scripts/config.js"></a>2. <code>scripts/config.js</code></h2><ul>
<li>初始化配置 config，引入 entry-runtime-with-compiler.js</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">// scripts\config.js</span><br><span class="line">...</span><br><span class="line">const aliases = require(&#x27;./alias&#x27;) // 看 ./alias 文件</span><br><span class="line">const resolve = p =&gt; &#123;</span><br><span class="line">  const base = p.split(&#x27;/&#x27;)[0]</span><br><span class="line">  if (aliases[base]) &#123;</span><br><span class="line">    return path.resolve(aliases[base], p.slice(base.length + 1))</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    return path.resolve(__dirname, &#x27;../&#x27;, p)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 配置定义</span><br><span class="line">const builds = &#123;</span><br><span class="line">  ... </span><br><span class="line">  // Runtime+compiler development build (Browser)</span><br><span class="line">  &#x27;web-full-dev&#x27;: &#123;</span><br><span class="line">    entry: resolve(&#x27;web/entry-runtime-with-compiler.js&#x27;), // 看 reslove ，由此找到对应文件真实路径</span><br><span class="line">    dest: resolve(&#x27;dist/vue.js&#x27;),</span><br><span class="line">    format: &#x27;umd&#x27;,</span><br><span class="line">    env: &#x27;development&#x27;,</span><br><span class="line">    alias: &#123; he: &#x27;./entity-decoder&#x27; &#125;,</span><br><span class="line">    banner</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 根据不同的环境，初始化参数 input, plugins, output, __VERSION__ 等</span><br><span class="line"> * @param &#123;*&#125; name 环境名</span><br><span class="line"> * @returns </span><br><span class="line"> */</span><br><span class="line">function genConfig (name) &#123;</span><br><span class="line">  const opts = builds[name] // 找 builds 中 name 配置</span><br><span class="line">  const config = &#123;</span><br><span class="line">     input: opts.entry,</span><br><span class="line">     external: opts.external,</span><br><span class="line">     plugins: [],</span><br><span class="line">     output: &#123;&#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">  return config</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 初始执行入口，找 TARGET 对应配置</span><br><span class="line">if (process.env.TARGET) &#123;</span><br><span class="line">  module.exports = genConfig(process.env.TARGET) // 看 genConfig</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  exports.getBuild = genConfig</span><br><span class="line">  exports.getAllBuilds = () =&gt; Object.keys(builds).map(genConfig)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="process-env-TARGET"><a href="#process-env-TARGET" class="headerlink" title="**process****.****env****.****TARGET**:"></a><code>**process****.****env****.****TARGET**</code><strong>:</strong></h3><p>这个 <code>process</code>  是nodejs 的 变量，</p>
<p>在  \node_modules@types\node\globals.d.ts 中：</p>
<p> <code>declare var process: NodeJS.Process;</code></p>
<h3 id="aliases："><a href="#aliases：" class="headerlink" title="aliases："></a><code>aliases</code>：</h3><p>根据上面的找<code>./alias</code> 文件，即：scripts&#x2F;alias.js，由此找到 <code>web/</code> 对应的文件全路径。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// </span><br><span class="line">...</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  vue: resolve(&#x27;src/platforms/web/entry-runtime-with-compiler&#x27;),</span><br><span class="line">  compiler: resolve(&#x27;src/compiler&#x27;),</span><br><span class="line">  core: resolve(&#x27;src/core&#x27;),</span><br><span class="line">  shared: resolve(&#x27;src/shared&#x27;),</span><br><span class="line">  web: resolve(&#x27;src/platforms/web&#x27;),</span><br><span class="line">  weex: resolve(&#x27;src/platforms/weex&#x27;),</span><br><span class="line">  server: resolve(&#x27;src/server&#x27;),</span><br><span class="line">  sfc: resolve(&#x27;src/sfc&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由此找到 <code> entry: resolve(&#39;web/entry-runtime-with-compiler.js&#39;),</code></p>
<p>拼接后的入口文件路径：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src/platforms/web/entry-runtime-with-compiler.js</span><br></pre></td></tr></table></figure>



<h2 id="3-platforms-web-entry-runtime-with-compiler-js"><a href="#3-platforms-web-entry-runtime-with-compiler-js" class="headerlink" title="3. platforms/web/entry-runtime-with-compiler.js"></a>3. <code>platforms/web/entry-runtime-with-compiler.js</code></h2><ul>
<li>导入  .&#x2F;runtime&#x2F;index，见 4.1；</li>
<li>扩展 Vue.prototype.$mount 方法；</li>
<li>导入  .&#x2F;compiler&#x2F;index 的 compileToFunctions 方法，挂载到 Vue.compile，见 4.2；</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">// 引入 /runtime/index 文件, 初始化 vue</span><br><span class="line">import Vue from &#x27;./runtime/index&#x27;</span><br><span class="line">...</span><br><span class="line">// 引入 /compiler/index 文件，初始化 compile 编译方法</span><br><span class="line">import &#123; compileToFunctions &#125; from &#x27;./compiler/index&#x27;</span><br><span class="line">...</span><br><span class="line">// 扩展 $mount 挂载方法</span><br><span class="line">const mount = Vue.prototype.$mount</span><br><span class="line">Vue.prototype.$mount = function (</span><br><span class="line">  el?: string | Element,</span><br><span class="line">  hydrating?: boolean</span><br><span class="line">): Component &#123;</span><br><span class="line">    ...</span><br><span class="line">    return mount.call(this, el, hydrating)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">// 定义 compile 方法</span><br><span class="line">Vue.compile = compileToFunctions</span><br><span class="line"></span><br><span class="line">export default Vue</span><br></pre></td></tr></table></figure>



<h2 id="4-1-platforms-web-runtime-index-js"><a href="#4-1-platforms-web-runtime-index-js" class="headerlink" title="4.1 platforms/web/runtime/index.js"></a>4.1 <code>platforms/web/runtime/index.js</code></h2><ul>
<li>导入 <code>core/index</code> ，vue 核心代码</li>
<li>定义 $mount 挂载方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 初始化 vue 核心代码</span><br><span class="line">import Vue from &#x27;core/index&#x27;</span><br><span class="line">...</span><br><span class="line">// 定义 $mount 挂载方法</span><br><span class="line">Vue.prototype.$mount = function (</span><br><span class="line">  el?: string | Element,</span><br><span class="line">  hydrating?: boolean</span><br><span class="line">): Component &#123;</span><br><span class="line">  // 初始化挂载组件</span><br><span class="line">  el = el &amp;&amp; inBrowser ? query(el) : undefined</span><br><span class="line">  ...</span><br><span class="line">  return mountComponent(this, el, hydrating)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">export default Vue</span><br></pre></td></tr></table></figure>



<h3 id="4-1-2-core-index-js"><a href="#4-1-2-core-index-js" class="headerlink" title="4.1.2 core/index.js"></a>4.1.2 <code>core/index.js</code></h3><ul>
<li>导入 core&#x2F;instance&#x2F;index.js </li>
<li>初始化 全局 API 方法，initGlobalAPI(Vue)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 初始化 vue 实例</span><br><span class="line">import Vue from &#x27;./instance/index&#x27;</span><br><span class="line">import &#123; initGlobalAPI &#125; from &#x27;./global-api/index&#x27;</span><br><span class="line">...</span><br><span class="line">// 初始化 Vue 全局 API</span><br><span class="line">initGlobalAPI(Vue)</span><br><span class="line">...</span><br><span class="line">export default Vue</span><br></pre></td></tr></table></figure>

<h4 id="4-1-2-1-instance-index"><a href="#4-1-2-1-instance-index" class="headerlink" title="4.1.2.1 ./instance/index"></a>4.1.2.1 <code>./instance/index</code></h4><ul>
<li>详见：<a target="_blank" rel="noopener" href="https://www.yuque.com/orange-yubdy/ki9i6o/knb6de">02- ‘src&#x2F;core&#x2F;instance&#x2F;index.js’</a></li>
</ul>
<h4 id="4-1-2-2-initGlobalAPI-Vue"><a href="#4-1-2-2-initGlobalAPI-Vue" class="headerlink" title="4.1.2.2 initGlobalAPI(Vue)"></a>4.1.2.2 <code>initGlobalAPI(Vue)</code></h4><ul>
<li>详见：<a target="_blank" rel="noopener" href="https://www.yuque.com/orange-yubdy/ki9i6o/vhrfsg">03 - core&#x2F;global-api&#x2F;index.js</a></li>
</ul>
<h2 id="4-2-platforms-web-compile-index-js"><a href="#4-2-platforms-web-compile-index-js" class="headerlink" title="4.2 platforms/web/compile/index.js"></a>4.2 <code>platforms/web/compile/index.js</code></h2><ul>
<li>通过  createCompiler(baseOptions) 初始化 compile， compileToFunctions  方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; baseOptions &#125; from &#x27;./options&#x27;</span><br><span class="line">import &#123; createCompiler &#125; from &#x27;compiler/index&#x27;</span><br><span class="line"></span><br><span class="line">const &#123; compile, compileToFunctions &#125; = createCompiler(baseOptions)</span><br><span class="line"></span><br><span class="line">export &#123; compile, compileToFunctions &#125;</span><br></pre></td></tr></table></figure>

<h2 id="附：-调试方法（基于-v2-6-14）"><a href="#附：-调试方法（基于-v2-6-14）" class="headerlink" title="附： 调试方法（基于 v2.6.14）"></a>附： 调试方法（基于 v2.6.14）</h2><ul>
<li><code>npm install</code></li>
<li>找到 examples 文件夹，打开任意一个，如 markdowm&#x2F;index.html，将引入的文件的vue文件由min修改为</li>
</ul>
<script src="../../dist/vue.js"></script>

<ul>
<li>直接浏览器打开 index.html 文件即可调试，如 file:&#x2F;&#x2F;&#x2F;E:&#x2F;workSpaces&#x2F;vue-2.6.14&#x2F;examples&#x2F;markdown&#x2F;index.html</li>
</ul>
</p><div class="tip">本文采用 CC-BY-SA-3.0 协议，转载请注明出处<br>作者: chengshuomin</div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-02-13</span><i class="fa fa-tag"></i><a class="tag" href="/tags/Vue源码/" title="Vue源码">Vue源码 </a><span class="leancloud_visitors"></span><span>大约823个字, 2分钟44秒读完</span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,http://example.com/101-源码学习入口/,学习笔记,1. 源码学习入口,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/102-Vue%E5%AE%9E%E4%BE%8B%E5%88%9D%E5%A7%8B%E5%8C%96/" title="2. Vue实例初始化">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/03-%E5%86%85%E5%AD%98/" title="内存">下一篇</a></li></ul></div><script src="/js/visitors.js"></script></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(无标题)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="想要查找什么..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>